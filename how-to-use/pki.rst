
.. _working-pki:

Работа с методом POST /pki/verify
======================================

.. Общий алгоритм работы с PKI состоит из следующих этапов:
   1. Пользователь готовит персональные данные для получения сертификата. Для физического лица такими данными могут быть ФИО, из которых формируется        ``commonName`` как идентификатор пользователя. Для юридических лиц это может быть наименование организации и её адрес.
   2. Пользователь отправляет данные в УЦ в формате ``*.req`` для создания сертификата. Администратор регистрирует данные о запросе в УЦ и на основе предоставленных данных выпускает сертификат пользователя.
   3. Пользователь получает сертификат в формате ``*.cer`` от администратора УЦ или самого УЦ.
   4. При помощи ПО `УЦ ПАК «КриптоПро УЦ 2.0» <https://www.cryptopro.ru/products/ca/2.0>`_ пользователь помещает сертификат в криптоконтейнер и передаёт его на ноду в keystore. 
   5. Далее пользователь может применять методы API :ref:`PKI <pki-api>` для использования ЭП.

Нода имеет возможность проверять УКЭП (Усиленная квалифицированная электронная подпись), используя метод API :ref:`Post /pki/verify <pki-api>`. Для корректности работы метода API :ref:`Post /pki/verify <pki-api>` необходимо установить корневой сертификат на ноду. Корневой сертификат УЦ однозначно идентифицирует центр сертификации и является основанием в цепочке доверия.

Как установить корневой сертификат на ноду
-------------------------------------------

Корневой сертификат устанавливается в следующую папку со средой Java:

    ::

      -keystore /Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/security/cacerts

Пароль по умолчанию на хранилище сертификатов Java cacerts - ``changeit``. При желании вы можете изменить пароль. Установка сертификатов выполняется следующей командой:

    ::

      sudo keytool -import -alias testAliasCA_cryptopro -keystore /Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/security/cacerts -file ~/Downloads/cert.cer






